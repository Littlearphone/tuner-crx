const y={fields:[],enable:!0,injectCSS:!0,injectScript:!0,configLabel:"配置开关"},k={active:!0,currentWindow:!0},h=[{id:"baidu-search",expectUrl:e=>/http(s)?:\/\/(www.)?baidu.com.*/.test(e.url),hacker:{state:"loading",style:["hack/baidu/search.css"],script:["hack/jquery.min.js","hack/common.js","hack/baidu/search.js"]},description:{enable:!0,injectCSS:!0,autoPaging:!0,injectScript:!0,backgroundBlur:12,backgroundColor:"#f6f6f6",configLabel:'"搜索"配置开关',fields:[{key:"autoPaging",label:"自动翻页",type:"SwitchField"},{key:"backgroundColor",label:"背景颜色",type:"ColorField"},{key:"backgroundImage",label:"背景图片",type:"UploadField"},{key:"blockedDomains",label:"域名屏蔽列表",type:"TextField"},{key:"backgroundBlur",label:"背景模糊",type:"SliderField",showInput:!1,step:1,min:0,max:100,marks:{24:"24",48:"48",72:"72"}}]}},{id:"baidu-zhidao",expectUrl:e=>/https?:\/\/zhidao[.]baidu[.]com\/question\/.*.html/.test(e.url),hacker:{state:"loading",style:"hack/baidu/zhidao.css",script:["hack/jquery.min.js","hack/baidu/zhidao.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"知道"配置开关',fields:[]}},{id:"baidu-jingyan",expectUrl:e=>/https?:\/\/jingyan[.]baidu[.]com\/article\/.*.html/.test(e.url),hacker:{state:"loading",style:"hack/baidu/jingyan.css",script:["hack/jquery.min.js","hack/baidu/jingyan.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"经验"配置开关',fields:[]}},{id:"baidu-baijiahao",expectUrl:e=>/https?:\/\/baijiahao[.]baidu[.]com\/s.*/.test(e.url),hacker:{state:"loading",style:"hack/baidu/baijiahao.css",script:["hack/jquery.min.js","hack/baidu/baijiahao.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"震惊"配置开关',fields:[]}},{id:"bing-search",expectUrl:e=>/http(s)?:\/\/(cn|www).bing.com(\/search)?.*([?&]q=.*).*/.test(e.url),hacker:{state:"loading",style:["hack/bing/search.css"],script:["hack/jquery.min.js","hack/common.js","hack/bing/search.js"]},description:{enable:!0,injectCSS:!0,enableHta:!0,autoPaging:!0,injectScript:!0,configLabel:'"搜索"配置开关',fields:[{key:"autoPaging",label:"自动翻页",type:"SwitchField"},{key:"enableHta",label:"划词翻译",type:"SwitchField"}]}},{id:"google-search",expectUrl:e=>/http(s)?:\/\/www.google.com(\/search)?.*([?&]q=.*).*/.test(e.url),hacker:{state:"loading",style:["hack/google/search.css"],script:["hack/jquery.min.js","hack/common.js","hack/google/search.js"]},description:{enable:!0,injectCSS:!0,autoPaging:!0,injectScript:!0,configLabel:'"搜索"配置开关',fields:[{key:"autoPaging",label:"自动翻页",type:"SwitchField"}]}},{id:"douyu-follow",expectUrl:e=>/http(s)?:\/\/www.douyu.com\/directory\/(myFollow|all)/.test(e.url),hacker:{state:"loading",style:"hack/douyu/live-directory.css",script:["hack/jquery.min.js","hack/douyu/live-directory.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"关注"配置开关',fields:[]}},{id:"douyu-room",expectUrl:e=>/http(s)?:\/\/www.douyu.com\/([0-9]+|topic\/.*[?]rid=[0-9]+)/.test(e.url),hacker:{state:"loading",style:["hack/douyu/live-room.css"],script:["hack/jquery.min.js","hack/common.js","hack/douyu/live-room.js"]},description:{enable:!0,danMuSize:30,injectCSS:!0,injectScript:!0,fullWebScreen:!0,configLabel:'"直播"配置开关',fields:[{key:"fullWebScreen",label:"网页全屏",type:"SwitchField"},{key:"danMuSize",label:"弹幕大小",type:"SliderField",showInput:!1,step:1,min:12,max:100,marks:{24:"24",48:"48",72:"72"}}]}},{id:"bilibili-video",expectUrl:e=>/http(s)?:\/\/www.bilibili.com\/((medialist\/play\/([0-9]+|ml[0-9]+\/BV[a-zA-Z0-9]+))|(bangumi\/play\/(ep|ss)[0-9]+)|(video\/(av|BV)[a-zA-Z0-9]+))(\?.*)?/.test(e.url),hacker:{state:"loading",style:"hack/bilibili/video.css",script:["hack/jquery.min.js","hack/bilibili/video.js"]},description:{enable:!0,injectCSS:!0,playbackRate:1.25,injectScript:!0,autoStartPlay:!0,fullWebScreen:!0,configLabel:'"视频"配置开关',fields:[{key:"autoStartPlay",label:"自动播放",type:"SwitchField"},{key:"fullWebScreen",label:"网页全屏",type:"SwitchField"},{key:"playbackRate",label:"播放速率",type:"SliderField",showInput:!1,step:.05,min:.1,max:5,marks:{1:"1.0",2:"2.0",3:"3.0",4:"4.0"}}]}},{id:"bilibili-live",expectUrl:e=>/http(s)?:\/\/live.bilibili.com\/[^/]+([?].*)?$/.test(e.url),hacker:{state:"loading",style:"hack/bilibili/live.css",script:["hack/jquery.min.js","hack/common.js","hack/bilibili/live.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,fullWebScreen:!0,configLabel:'"直播"配置开关',fields:[{key:"fullWebScreen",label:"网页全屏",type:"SwitchField"}]}},{id:"bilibili-dynamic",expectUrl:e=>/http(s)?:\/\/t.bilibili.com(\/?.*)?/.test(e.url),hacker:{state:"loading",style:"hack/bilibili/dynamic.css",script:["hack/jquery.min.js","hack/bilibili/dynamic.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"主页"配置开关',fields:[]}},{id:"segmentfault-question",expectUrl:e=>/http.?:\/\/(.*[.])?segmentfault[.]com\/q\/.*/.test(e.url),hacker:{state:"loading",style:"hack/segmentfault/question.css",script:["hack/jquery.min.js","hack/segmentfault/question.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"问答"配置开关',fields:[]}},{id:"segmentfault-articles",expectUrl:e=>/http.?:\/\/(.*[.])?segmentfault[.]com\/a\/.*/.test(e.url),hacker:{state:"loading",style:"hack/segmentfault/articles.css",script:["hack/jquery.min.js","hack/segmentfault/articles.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"文章"配置开关',fields:[]}},{id:"cnblogs-articles",expectUrl:e=>/https?:\/\/www[.]cnblogs[.]com\/.*\/(p|articles|archive)\/.*[.]html/.test(e.url),hacker:{state:"loading",style:"hack/cnblogs/articles.css",script:["hack/jquery.min.js","hack/cnblogs/articles.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"文章"配置开关',fields:[]}},{id:"iteye-magazines",expectUrl:e=>/https?:\/\/www[.]iteye[.]com\/magazines\/.*/.test(e.url),hacker:{state:"loading",style:"hack/iteye/magazines.css",script:["hack/jquery.min.js","hack/iteye/magazines.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"杂志"配置开关',fields:[]}},{id:"iteye-blog",expectUrl:e=>/https?:\/\/www[.]iteye[.]com\/blog\/.*/.test(e.url),hacker:{state:"loading",style:"hack/iteye/blog.css",script:["hack/jquery.min.js","hack/iteye/blog.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"博客"配置开关',fields:[]}},{id:"csdn-article",expectUrl:e=>/https?:\/\/(\w+[.])?blog[.]csdn[.]net\/(.*\/)?article\/details\/.*/.test(e.url),hacker:{state:"loading",style:"hack/csdn/article.css",insert:["hack/csdn/article-front.js"],script:["hack/jquery.min.js","hack/csdn/article-back.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"文章"配置开关',fields:[]}},{id:"csdn-topics",expectUrl:e=>/https?:\/\/bbs[.]csdn[.]net\/topics\/.*/.test(e.url),hacker:{state:"loading",style:"hack/csdn/topics.css",script:["hack/jquery.min.js","hack/csdn/topics.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"话题"配置开关',fields:[]}},{id:"snippet-hack",expectUrl:e=>!e.url.startsWith("edge://")&&!e.url.startsWith("chrome://")&&!e.url.startsWith("chrome-extension://"),hacker:{state:"loading",style:"hack/snippet/snippet.css",script:["hack/jquery.min.js","hack/snippet/snippet.js"]},description:{enable:!0,injectCSS:!0,injectScript:!0,configLabel:'"通用"配置开关',fields:[]}}];function f(e,c,t){const i=e.data;fetch(i.url,{method:i.type,body:i.body}).then(async r=>t({url:i.url,status:r.status,responseURL:r.url,responseText:await r.text()})).catch(r=>t("")||console.warn("跨域请求失败：",r)||console.table(i))}function u(e){return typeof e=="string"?[e]:e}function l(e,c){return!e.hasOwnProperty(c)||e[c]}async function p(e,c,t,i){if(!l(i,"enable")||!l(i,"injectScript"))return console.log("该页面脚本注入未启用");const r=["hack/injected.js"];(u(e.hacker.script)||[]).forEach(s=>r.push(s));const a={allFrames:!t.frameId,tabId:c};t.frameId&&(a.frameIds=[t.frameId]),await chrome.scripting.executeScript({files:r,target:a,injectImmediately:!0}),console.log("页面脚本注入完成: ",t.url),console.table(r),j(c,Object.assign({site:e},{config:i}),s=>console.log("传递页面配置完成",s))}async function g(e,c,t,i){if(!l(i,"enable")||!l(i,"injectCSS"))return console.log("该页面样式注入未启用");const r=["hack/common.css"];(u(e.hacker.style)||[]).forEach(s=>r.push(s));const a={allFrames:!t.frameId,tabId:c};t.frameId&&(a.frameIds=[t.frameId]),await chrome.scripting.insertCSS({files:r,target:a}),console.log("页面样式注入完成: ",t.url),console.table(r)}function b(){const e=chrome.runtime.lastError;if(e)throw new Error(e)}async function d(e){const c=await chrome.tabs.get(e);try{return b(),c}catch(t){console.log("safeGetTab",t.message)}}const o={};function S(e,c,t){if(!t||!t.url||!t.url.startsWith("http://")&&!t.url.startsWith("https://"))return;const i=h.find(r=>r.expectUrl(t))||{hacker:{state:void 0},description:{enable:!1},id:new Date().toISOString()};d(e).then(async()=>{i.id&&chrome.action.enable(e);const r=c&&c.status;if(!(!i.hacker||r!==i.hacker.state&&r!==!0)&&!o[t.url]){o[t.url]=!0;try{const n=await m(i.id),a=Object.assign({configId:i.id},i.description,n[i.id]);console.log("页面配置获取成功: ",t.url),console.table(a),await g(i,e,t,a),await p(i,e,t,a)}finally{delete o[t.url]}}})}function j(e,c,t){d(e).then(()=>chrome.tabs.sendMessage(e,c,t))}function w(e){return!e||!chrome.storage||!chrome.storage.local?new Promise(c=>c({})):chrome.storage.local.set(e)}function m(e){return!e||!chrome.storage||!chrome.storage.local?new Promise(c=>c({})):typeof e=="string"?chrome.storage.local.get([e]):(Array.isArray(e),chrome.storage.local.get(e))}export{k as A,y as D,h as H,f as a,m as g,S as p,w as s};
